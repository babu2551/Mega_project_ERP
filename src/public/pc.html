<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Programme Coordinator Details Form</title>

    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      body {
        background: #e9ebff;
        padding: 25px;
      }

      /* Container */
      .container {
        width: 90%;
        max-width: 1100px;
        margin: auto;
        background: #fff;
        border-radius: 14px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        overflow: hidden;
      }

      /* Header */
      .form-header {
        background: linear-gradient(90deg, #5b5ada, #9257d9);
        padding: 20px;
        text-align: center;
      }

      .form-header h2 {
        color: white;
        font-weight: 600;
      }

      /* Form Grid */
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 22px;
        padding: 25px;
      }

      .form-group label {
        font-size: 14px;
        font-weight: 600;
      }

      .form-group span {
        color: red;
      }

      .form-group input {
        margin-top: 5px;
        width: 100%;
        padding: 13px;
        border-radius: 10px;
        border: 1.7px solid #ddd;
        background: #f9f9f9;
        font-size: 15px;
        outline: none;
        transition: 0.2s ease;
      }

      .form-group input:focus {
        border-color: #5b5ada;
        background: #fff;
      }

      /* Buttons */
      .btn-row {
        display: flex;
        justify-content: center;
        padding: 20px 25px;
      }

      .submit-btn {
        background: #08a045;
        color: white;
        border: none;
        padding: 15px 25px;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        width: 48%;
        transition: 0.3s ease;
      }

      .submit-btn:hover {
        background: #067c36;
      }

      .view-btn {
        background: #ff7b00;
        color: white;
        border: none;
        padding: 15px 25px;
        border-radius: 10px;
        font-size: 16px;
        cursor: pointer;
        width: 48%;
        transition: 0.3s ease;
      }

      .view-btn:hover {
        background: #d86400;
      }

      .error {
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-3px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .form-grid {
          grid-template-columns: 1fr;
        }

        .btn-row {
          flex-direction: column;
          gap: 10px;
        }

        .submit-btn,
        .view-btn {
          width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="form-header">
        <h2>Programme Coordinator Details Form</h2>
      </div>

      <form class="form-grid">
        <!-- Academic Year -->
        <div class="form-group">
          <label>Academic Year <span>*</span></label>
          <input type="text" placeholder="e.g., 2023-24" />
        </div>

        <!-- Programme Code -->
        <div class="form-group">
          <label>Programme Code <span>*</span></label>
          <input type="text" placeholder="As per institute" />
        </div>

        <!-- Semester -->
        <div class="form-group">
          <label>Semester <span>*</span></label>
          <input type="text" placeholder="Jan–June / Jul–Dec" />
        </div>

        <!-- Year of Introduction -->
        <div class="form-group">
          <label>Year of Introduction <span>*</span></label>
          <input type="text" placeholder="e.g., 2020" />
        </div>

        <!-- School Name -->
        <div class="form-group">
          <label>School/Faculty Name <span>*</span></label>
          <input type="text" placeholder="e.g., School of Engineering" />
        </div>

        <!-- Coordinator Name -->
        <div class="form-group">
          <label>Coordinator Name <span>*</span></label>
          <input type="text" placeholder="e.g., Dr. John Doe" />
        </div>

        <!-- Department Name -->
        <div class="form-group">
          <label>Department Name <span>*</span></label>
          <input type="text" placeholder="e.g., Computer Science" />
        </div>

        <!-- Coordinator Email -->
        <div class="form-group">
          <label>Coordinator Email <span>*</span></label>
          <input type="email" placeholder="e.g., john.doe@university.edu" />
        </div>

        <!-- Programme Name -->
        <div class="form-group">
          <label>Programme Name <span>*</span></label>
          <input type="text" placeholder="e.g., B.Tech CSE" />
        </div>

        <!-- Coordinator Contact -->
        <div class="form-group">
          <label>Coordinator Contact <span>*</span></label>
          <input type="text" placeholder="e.g., +91-9876543210" />
        </div>

        <!-- Upload Brochure/Document
        <div class="form-group">
          <label>Upload Brochure/Document</label>
          <input
            type="file"
            id="brochureUpload"
            accept=".pdf,.jpg,.jpeg,.png,.csv"
          />
        </div> -->
      </form>

      <!-- Buttons Section -->
      <div class="btn-row">
        <button class="submit-btn">
          <i class="fa-solid fa-check"></i> Submit Programme Details
        </button>
      </div>
    </div>

    <script>
      // Load coordinator's available programme codes on page load
      async function loadMyCourses() {
        try {
          const token = localStorage.getItem("token");
          const res = await fetch("/api/pc/my-courses", {
            headers: { Authorization: "Bearer " + token },
          });
          if (res.ok) {
            const data = await res.json();
            console.log("Available programme codes:", data.programmeCodes);
            // Could populate programmeCode dropdown/input with suggestions
          }
        } catch (e) {
          console.error("Courses load failed:", e);
        }
      }

      // Call on page load
      loadMyCourses();

      document.addEventListener("DOMContentLoaded", () => {
        const submitBtn = document.querySelector(".submit-btn");
        const form = document.querySelector(".form-grid");

        submitBtn.addEventListener("click", async function (e) {
          e.preventDefault();

          let inputs = form.querySelectorAll("input");
          let allFilled = true;
          const payload = {};
          const keys = [
            "academicYear",
            "programmeCode",
            "semester",
            "yearOfIntroduction",
            "schoolName",
            "coordinatorName",
            "departmentName",
            "coordinatorEmail",
            "programmeName",
            "coordinatorContact",
          ];

          inputs.forEach((input, idx) => {
            input.classList.remove("error");
            const v = input.value.trim();
            if (v === "") {
              allFilled = false;
              input.classList.add("error");
              input.style.border = "2px solid red";
              input.style.animation = "shake 0.2s ease";
              setTimeout(() => (input.style.animation = ""), 200);
            } else {
              input.style.border = "1.7px solid #ddd";
            }
            payload[keys[idx]] = v;
          });

          if (!allFilled) {
            alert("⚠ Please fill all required fields!");
            return;
          }

          const token = (() => {
            try {
              return localStorage.getItem("token");
            } catch (e) {
              return null;
            }
          })();
          if (!token) {
            alert("You must be logged in as PC coordinator to submit.");
            return;
          }

          try {
            // Create FormData to support file uploads
            const formData = new FormData();

            // Add form fields
            keys.forEach((key, idx) => {
              formData.append(key, payload[key]);
            });

            // Add file if selected
            const fileInput = document.getElementById("brochureUpload");
            if (fileInput && fileInput.files.length > 0) {
              formData.append("brochureFile", fileInput.files[0]);
            }

            const res = await fetch("/api/pc/submit", {
              method: "POST",
              headers: {
                Authorization: "Bearer " + token,
              },
              body: formData,
            });

            const data = await res.json().catch(() => ({}));
            if (!res.ok) {
              alert(data.error || "Failed to submit programme details");
              return;
            }

            alert(data.message || "Programme details submitted successfully");
            // redirect to PC dashboard with filters for the submitted programme
            const programmeCode = payload.programmeCode || "";
            const programmeName = payload.programmeName || "";
            window.location.href = `pcdashboard.html?code=${encodeURIComponent(
              programmeCode
            )}&name=${encodeURIComponent(programmeName)}`;
          } catch (err) {
            console.error("PC submit failed", err);
            alert("Server error while submitting.");
          }
        });
      });

      // Shake animation
      const style = document.createElement("style");
      style.innerHTML = `
@keyframes shake {
  0% { transform: translateX(0px); }
  25% { transform: translateX(-3px); }
  50% { transform: translateX(3px); }
  75% { transform: translateX(-3px); }
  100% { transform: translateX(0px); }
}
`;
      document.head.appendChild(style);
    </script>
  </body>
</html>
